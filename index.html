<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scroll Performance Analyzer</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<header>
  <h1>Scroll Performance Analyzer</h1>
  <p class="muted">Measure FPS, layout shifts and long JS tasks while you scroll.</p>
</header>

<main>
  <section class="controls card">
    <label for="testTarget">Test target:</label>
    <select id="testTarget">
    <option value="local">Use local test page (below)</option>
    </select>

  <div class="buttons">
    <button id="startBtn">Start Test</button>
    <button id="stopBtn" disabled>Stop Test</button>
    <button id="exportBtn" disabled>Export JSON</button>
  </div>

    <div id="thresholdRow">
    <label>FPS threshold:
    <input type="number" id="fpsThreshold" value="45" min="1" max="60" />
    </label>
    </div>
  </section>

  <section class="visuals card">
    <h2>Live Metrics</h2>
    <div class="charts">
      <canvas id="fpsChart" height="120"></canvas>
    </div>

    <div class="metrics">
      <div><strong>Current FPS:</strong> <span id="currentFps">—</span></div>
      <div><strong>Average FPS:</strong> <span id="avgFps">—</span></div>
      <div><strong>Dropped Frames:</strong> <span id="droppedFrames">—</span></div>
      <div><strong>Layout Shift Score:</strong> <span id="layoutShift">—</span></div>
      <div><strong>Long Tasks (count):</strong> <span id="longTaskCount">—</span></div>
    </div>
  </section>

  <section class="report card">
    <h2>Summary Report</h2>
    <pre id="reportArea">No report yet.</pre>
  </section>

  <section class="test-area card">
    <h2>Local Scroll Test Content</h2>
    <p>Use this content to scroll for local testing.</p>

    <div id="testContent" class="testcontent">
      <!-- Long content to scroll -->
    <div class="big-grid">
      <!-- generate many tiles -->
      <!-- We fill with JS on load for easier editing -->
    </div>
    </div>
  </section>
</main>

<button id="perfDebugButton" class="perf-debug-button" title="Toggle Performance Panel">⚙️</button>

  <!-- Performance Side Panel -->
  <aside id="perfPanel" class="perf-panel perf-panel--hidden" aria-hidden="true">
    <header class="perf-panel_header">
      <div>
        <h2>Performance Panel</h2>
        <p class="perf-panel_subtitle">toggle</p>
      </div>
      <button id="perfPanelClose" class="perf-panel_close" aria-label="Close panel">☒</button>
    </header>

    <section class="perf-panel_section">
      <h3>Forced Reflow Detector</h3>
      <p class="perf-panel_help">Runs a synthetic layout-read pass over the local test tiles using<code>performance.now()</code>. Higher times imply heavier layout work.</p>
      <button id="runReflowBtn" class="perf-panel_button">Run Reflow Scan</button>
      <div class="perf-panel_result">
        Last scan: <span id="reflowOutput">No scan yet.</span>
      </div>
    </section>

    <section class="perf-panel_section">
      <h3>Paint Cost Estimator</h3>
      <p class="perf-panel_help">Toggles a visual class on all tiles and measures estimated layout/paint cost.</p>
      <button id="runPaintBtn" class="perf-panel_button">Estimate Paint Cost</button>
      <div class="perf-panel_result">
        Last estimate: <span id="paintOutput">No estimate yet.</span>
      </div>
    </section>

    <section class="perf-panel_section">
      <h3>What-If Throttle/Debounce Modes</h3>
      <p class="perf-panel_help">Applies different scroll handler strategies to the local test area so you can see how often the handler really runs.</p>
      <label class="perf-panel_label">
        Mode:
        <select id="scrollModeSelect" class="perf-panel_select">
          <option value="off">None (raw scroll)</option>
          <option value="throttle-60">Throttle 60ms</option>
          <option value="throttle-120">Throttle 120ms</option>
          <option value="debounce-120">Debounce 120ms</option>
        </select>
      </label>

      <div class="perf-panel_result">
        Handler activity (last 5s window):<br /><span id="scrollModeStats">No data yet.</span>
      </div>
    </section>
  </aside>

  <footer>
    <small>Built with PerformanceObserver, requestAnimation & Chart.js</small>
  </footer>

<script src="script.js"></script>
<script src="panel.js"></script>
</body>
</html>


